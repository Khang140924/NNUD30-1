<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh s√°ch S·∫£n ph·∫©m</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }

        /* === THANH C√îNG C·ª§ === */
        .toolbar {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        input, select {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            min-width: 150px;
        }

        /* === B·∫¢NG D·ªÆ LI·ªÜU === */
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px 15px;
            border: 1px solid #ddd;
            text-align: left;
            vertical-align: middle;
        }

        th {
            background-color: #333;
            color: #fff;
            text-transform: uppercase;
            font-size: 0.9em;
        }

        /* Y√™u c·∫ßu: 1 d√≤ng ƒëen, 1 d√≤ng tr·∫Øng */
        tbody tr:nth-child(odd) {
            background-color: #ffffff;
            color: #000000;
        }

        tbody tr:nth-child(even) {
            background-color: #000000;
            color: #ffffff;
        }

        /* H√¨nh ·∫£nh trong b·∫£ng */
        .product-img {
            width: 80px;
            height: 80px;
            object-fit: cover; /* ƒê·∫£m b·∫£o khung h√¨nh vu√¥ng ƒë·∫πp */
            border-radius: 4px;
            border: 1px solid #ccc;
            background-color: #fff;
        }

        /* === PH√ÇN TRANG === */
        .pagination {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 5px;
        }

        .pagination button {
            padding: 8px 12px;
            border: 1px solid #ccc;
            background-color: white;
            cursor: pointer;
            border-radius: 4px;
        }

        .pagination button.active {
            background-color: #333;
            color: white;
            font-weight: bold;
        }

        .pagination button:disabled {
            background-color: #eee;
            cursor: not-allowed;
        }
    </style>
</head>
<body>

    <div class="toolbar">
        <div class="control-group">
            <label>üîç T√¨m ki·∫øm theo t√™n:</label>
            <input type="text" id="searchInput" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m..." oninput="handleSearch(this.value)">
        </div>

        <div class="control-group">
            <label>üîÉ S·∫Øp x·∫øp:</label>
            <select id="sortSelect" onchange="handleSort(this.value)">
                <option value="">-- M·∫∑c ƒë·ªãnh --</option>
                <option value="price-asc">üí∞ Gi√°: Th·∫•p ƒë·∫øn Cao</option>
                <option value="price-desc">üí∞ Gi√°: Cao ƒë·∫øn Th·∫•p</option>
                <option value="title-asc">üÖ∞Ô∏è T√™n: A - Z</option>
                <option value="title-desc">üÖ∞Ô∏è T√™n: Z - A</option>
            </select>
        </div>

        <div class="control-group">
            <label>üìÑ S·ªë d√≤ng/trang:</label>
            <select id="pageSizeSelect" onchange="handlePageSize(this.value)">
                <option value="5">5 d√≤ng</option>
                <option value="10">10 d√≤ng</option>
                <option value="20">20 d√≤ng</option>
            </select>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th style="width: 50px;">ID</th>
                <th style="width: 100px;">H√¨nh ·∫£nh</th>
                <th>T√™n s·∫£n ph·∫©m</th>
                <th style="width: 150px;">Gi√° ($)</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <tr><td colspan="4" style="text-align:center;">ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>
        </tbody>
    </table>

    <div class="pagination" id="pagination"></div>

    <script>
        // === 1. C·∫§U H√åNH & TR·∫†NG TH√ÅI ===
        const API_URL = 'https://api.escuelajs.co/api/v1/products';
        let originalData = []; // D·ªØ li·ªáu g·ªëc t·ª´ API
        let filteredData = []; // D·ªØ li·ªáu sau khi l·ªçc/sort
        
        let state = {
            page: 1,
            limit: 5,
            search: '',
            sortBy: '' // 'price-asc', 'price-desc', 'title-asc', 'title-desc'
        };

        // === 2. H√ÄM KH·ªûI T·∫†O ===
        async function init() {
            try {
                const response = await fetch(API_URL);
                originalData = await response.json();
                
                // Sao ch√©p d·ªØ li·ªáu g·ªëc sang filteredData ƒë·ªÉ x·ª≠ l√Ω
                filteredData = [...originalData];
                
                renderTable();
            } catch (error) {
                console.error("L·ªói t·∫£i API:", error);
                document.getElementById('tableBody').innerHTML = `<tr><td colspan="4" style="color:red; text-align:center;">L·ªói t·∫£i d·ªØ li·ªáu!</td></tr>`;
            }
        }

        // === 3. X·ª¨ L√ù LOGIC (Filter -> Sort -> Paginate) ===
        function processData() {
            // A. L·ªçc theo t√™n (T√¨m ki·∫øm)
            let result = originalData.filter(item => 
                item.title.toLowerCase().includes(state.search.toLowerCase())
            );

            // B. S·∫Øp x·∫øp
            if (state.sortBy) {
                result.sort((a, b) => {
                    const [field, order] = state.sortBy.split('-');
                    
                    if (field === 'price') {
                        return order === 'asc' ? a.price - b.price : b.price - a.price;
                    } else if (field === 'title') {
                        const titleA = a.title.toLowerCase();
                        const titleB = b.title.toLowerCase();
                        if (titleA < titleB) return order === 'asc' ? -1 : 1;
                        if (titleA > titleB) return order === 'asc' ? 1 : -1;
                        return 0;
                    }
                });
            }

            filteredData = result;
            
            // Reset v·ªÅ trang 1 n·∫øu s·ªë l∆∞·ª£ng trang thay ƒë·ªïi v√† trang hi·ªán t·∫°i v∆∞·ª£t qu√°
            const totalPages = Math.ceil(filteredData.length / state.limit);
            if (state.page > totalPages) state.page = totalPages || 1;
        }

        // === 4. RENDER GIAO DI·ªÜN ===
        function renderTable() {
            processData(); // Ch·∫°y l·∫°i logic x·ª≠ l√Ω d·ªØ li·ªáu

            const tbody = document.getElementById('tableBody');
            const paginationDiv = document.getElementById('pagination');

            // T√≠nh to√°n ph√¢n trang
            const start = (state.page - 1) * state.limit;
            const end = start + state.limit;
            const pageData = filteredData.slice(start, end);

            // X√≥a n·ªôi dung c≈©
            tbody.innerHTML = '';

            if (pageData.length === 0) {
                tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£</td></tr>`;
                paginationDiv.innerHTML = '';
                return;
            }

            // Render t·ª´ng d√≤ng
            pageData.forEach(item => {
                // L·∫•y h√¨nh ƒë·∫ßu ti√™n, n·∫øu kh√¥ng c√≥ th√¨ d√πng h√¨nh m·∫∑c ƒë·ªãnh
                let imgUrl = (item.images && item.images.length > 0) ? item.images[0] : 'https://via.placeholder.com/80';
                
                // X·ª≠ l√Ω chu·ªói h√¨nh ·∫£nh b·ªã l·ªói JSON (m·ªôt s·ªë API tr·∫£ v·ªÅ chu·ªói stringify)
                if (typeof imgUrl === 'string' && imgUrl.startsWith('["')) {
                    try { imgUrl = JSON.parse(imgUrl)[0]; } catch(e) {}
                }

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${item.id}</td>
                    <td>
                        <img src="${imgUrl}" alt="${item.title}" class="product-img" onerror="this.src='https://via.placeholder.com/80?text=No+Image'">
                    </td>
                    <td>${item.title}</td>
                    <td><b>$${item.price}</b></td>
                `;
                tbody.appendChild(tr);
            });

            renderPagination();
        }

        function renderPagination() {
            const paginationDiv = document.getElementById('pagination');
            const totalPages = Math.ceil(filteredData.length / state.limit);
            
            let html = '';
            
            // Ch·ªâ hi·ªán ph√¢n trang n·∫øu c√≥ nhi·ªÅu h∆°n 1 trang
            if (totalPages > 1) {
                // N√∫t Previous
                html += `<button onclick="changePage(${state.page - 1})" ${state.page === 1 ? 'disabled' : ''}>¬´</button>`;

                // Logic hi·ªÉn th·ªã s·ªë trang r√∫t g·ªçn (ƒë·ªÉ tr√°nh qu√° d√†i)
                let startPage = Math.max(1, state.page - 2);
                let endPage = Math.min(totalPages, state.page + 2);

                if (startPage > 1) html += `<button onclick="changePage(1)">1</button><span>...</span>`;

                for (let i = startPage; i <= endPage; i++) {
                    html += `<button onclick="changePage(${i})" class="${i === state.page ? 'active' : ''}">${i}</button>`;
                }

                if (endPage < totalPages) html += `<span>...</span><button onclick="changePage(${totalPages})">${totalPages}</button>`;

                // N√∫t Next
                html += `<button onclick="changePage(${state.page + 1})" ${state.page === totalPages ? 'disabled' : ''}>¬ª</button>`;
            }

            paginationDiv.innerHTML = html;
        }

        // === 5. X·ª¨ L√ù S·ª∞ KI·ªÜN ===
        function handleSearch(val) {
            state.search = val;
            state.page = 1; // Reset v·ªÅ trang 1 khi t√¨m ki·∫øm
            renderTable();
        }

        function handleSort(val) {
            state.sortBy = val;
            renderTable();
        }

        function handlePageSize(val) {
            state.limit = parseInt(val);
            state.page = 1; // Reset v·ªÅ trang 1
            renderTable();
        }

        function changePage(newPage) {
            if (newPage < 1 || newPage > Math.ceil(filteredData.length / state.limit)) return;
            state.page = newPage;
            renderTable();
        }

        // Ch·∫°y khi t·∫£i trang
        init();

    </script>
</body>
</html>